[音视频基础教程](https://ffmpeg.xianwaizhiyin.net/base-knowledge/base-knowledge.html)
# 主要流程
## 色彩空间基础

## 采集
音视频采集是指将麦克风、摄像头等音视频设备中的模拟信号转换成数字信号的过程。这个数字信号可以是PCM音频数据或者视频帧。在采集过程中需要确定采样率、采样精度等参数。
## 编码
音视频编码是指将数字信号转换成可传输或存储的格式的过程。常见的音视频编码格式有H.264、H.265、VP8、VP9、AAC、MP3等。编码后的音视频数据可以更有效地进行传输和存储
### H.264

### H.265

## 封装与传输 

RTMP（Real-Time Messaging Protocol） 是基于TCP协议的，这使得它能够提供较为稳定的数据传输服务。由于TCP协议具有重传机制和确保数据包按序到达的特点，因此RTMP适用于需要保证数据完整性和顺序性的场景，如视频直播、互动式通信等。虽然这可能会带来比基于UDP的协议稍高的延迟，但它更适合那些对数据丢失敏感的应用。
RTP（Real-time Transport Protocol） 则是基于UDP协议的，这意味着它能够实现较低的延迟，但不保证数据包的可靠传输或顺序到达。RTP通常用于对实时性要求较高的应用场景，比如视频会议、IP电话等。为了弥补UDP在传输质量监控上的不足，RTP通常与RTCP（Real-time Transport Control Protocol）一起使用。RTCP负责监控RTP传输的质量，并提供关于当前传输状态的信息，如丢包率、延迟等统计数据，帮助调整发送速率或者通知接收端当前流的状态。
### RTP
实时传输协议（Real-time Transport Protocol，简称RTP）是一种用于在网络中传输实时数据，如音频、视频或模拟数据的网络协议。

RTP运行在传输层协议之上，通常是UDP（用户数据报协议），因为TCP的重传机制不适合实时通信的要求。RTP包由两部分组成：头部和有效载荷。头部包含了关键的信息，如版本号、序列号、时间戳和SSRC（同步源标识符），而有效载荷则包含了实际的媒体数据。

### RTCP
实时传输控制协议（Real-time Transport Control Protocol，简称RTCP）是与实时传输协议（RTP）一起使用的协议，主要用于服务质量的监视和反馈，以及在多媒体数据传输中参与者之间的信息交换。RTCP本身并不传输数据，而是与RTP配合使用，为RTP流提供控制功能。

**主要功能**：
```
质量监控：RTCP收集关于接收端的质量报告，如丢包率、延迟抖动等信息，并将这些信息反馈给发送端和其他接收端。这有助于评估当前会话的质量并进行相应的调整。
参与者信息交换：通过RTCP，参与者可以交换标识信息（CNAME），这对于识别不同的媒体流特别有用，尤其是在多播情况下。
同步不同媒体流：RTCP报文包含时间戳信息，可用于同步音频和视频等不同类型的媒体流。
```
**报文类型**

RTCP支持多种类型的控制报文，包括但不限于：
```
SR (Sender Report)：由发送者发送，包含发送者的传输和接收统计数据，如发送的字节数、发送的包数、RTP时钟的最新时间戳等。
RR (Receiver Report)：由接收者发送，包含接收统计数据，如接收到的包数、丢失率等。
SDES (Source Description Items)：用于描述源的信息，如CNAME、名称、电子邮件地址等。
BYE：表示某一会话参与者离开会话。
APP (Application Defined)：保留给应用程序自定义用途。
```
RTCP通常以较低的速率运行，相对于RTP流的数据量来说，它的开销较小。

为了防止过多的控制流量影响网络性能，RTCP流量一般限制在一个会话总带宽的小部分（默认5%）。

RTCP是基于UDP的，因此它也不保证报文的可靠传输。

RTCP的设计目的是为了在不干扰RTP数据流的前提下，提供对多媒体数据传输的有效监控和支持。通过这种方式，它使得多媒体应用能够在各种网络条件下提供更好的用户体验。

|RTP|RTCP|
|---|---|
|负责实际数据的封装和传输。它为每个数据包添加必要的信息，如时间戳和序列号，以便于接收方正确地重组这些数据。|通常与RTP一起使用，提供关于服务质量的反馈和参与者信息交换。RTCP报文不传输媒体数据，而是包含了诸如发送统计、接收质量报告等控制信息。|

### RTMP
RTMP（Real-Time Messaging Protocol）是一种设计用于实时传输音频、视频和数据的网络协议，主要用于流媒体传输。支持Flash播放器与服务器之间的通信，以实现在线音视频内容的高效传输。RTMP通过TCP端口1935进行通信，默认情况下使用此端口来保证数据传输的可靠性。
## 收包

### 抖动缓冲
抖动缓冲（Jitter Buffer）是一种用于处理网络数据传输过程中产生的延迟变化（即抖动）的技术，特别是在实时通信系统中，如VoIP（互联网协议语音）、视频会议等。由于网络状况的变化，数据包可能不会以恒定的速率到达目的地，这种现象被称为“抖动”。抖动会导致音频或视频流的播放出现断续，影响用户体验。

**抖动缓冲的工作原理**：

抖动缓冲通过在接收端创建一个临时存储区域来解决这个问题。当数据包到达时，它们首先被存储在这个缓冲区中，而不是立即进行解码和播放。缓冲区会等待一段时间，确保所有相关的数据包都已到达，然后再按正确的顺序传递给解码器进行处理。这样就可以平滑地播放媒体流，减少因网络延迟波动带来的负面影响。

**抖动缓冲的类型**：
```
静态抖动缓冲：预先设定好固定大小的缓冲区。这种方式的优点是简单易行，但缺点是对不同的网络条件适应性较差。
动态抖动缓冲：能够根据当前网络状况自动调整缓冲区的大小。当网络抖动增加时，它可以扩大缓冲区；反之，则缩小缓冲区。这使得它能更好地适应网络环境的变化，但实现起来相对复杂一些。
```
**优缺点**：

优点：
```
减少了由于网络延迟不一致导致的媒体播放中断问题。
改善了整体的通话质量，尤其是在不稳定网络条件下。
```
缺点：
```
增加了额外的延迟，因为数据包需要先存储在缓冲区中。
如果设置不当，可能会导致过高的延迟或无法完全消除抖动的影响。
```
为了达到最佳效果，抖动缓冲的配置通常需要平衡延迟与消除抖动之间的关系。在实际应用中，很多系统都会采用自适应算法来优化这一过程，从而提供尽可能好的用户体验。


## 组帧

## 解码
音视频解码是指将接收到的音视频数据解码成原始的数字信号的过程。解码器需要知道解码的格式和参数。解码后的音视频数据可以用于播放或者后续处理。

## 渲染
音视频渲染是指将解码后的音视频数据还原成模拟信号，输出到扬声器或者显示器上。在渲染过程中需要注意音频音量控制和视频的帧率、分辨率等参数

# 协议

### RTSP
（Real-Time Streaming Protocol）是一种网络控制协议，主要用于娱乐和通信系统中，以控制流媒体服务器。该协议用于建立和控制一个或多个时间同步的连续媒体流。客户端可以通过RTSP请求来实现对多媒体播放的控制，如播放、暂停、快进、快退等操作。RTSP本身并不传输数据，它作用类似于遥控器，用来告诉服务器执行特定的操作。实际的音频或视频数据传输通常通过RTP（Real-time Transport Protocol）或者其他的传输协议完成。因此，RTSP可以被看作是管理和控制这些数据流的一种方式。


